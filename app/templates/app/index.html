{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Cadastrar Questão</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{% static 'app/css/bootstrap.min.css' %}" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="{% static 'app/js/bootstrap.min.js' %}"></script>
</head>
<body>

  {% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
  {% endfor %}
  {% endif %}

<div class="container mt-5 mb-5" style="max-width: 600px;">
  <h2 class="mb-4">Cadastrar Questão</h2>

  <form method="post" action="">
    {% csrf_token %}

    <!-- Área -->
    <div class="mb-3">
      <label for="area" class="form-label">Área</label>
      <select name="area" id="area" class="form-select" required>
        <option value="">Selecione a área</option>
        {% for area in areas %}
          <option value="{{ area.id }}">{{ area.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Unidade -->
    <div class="mb-3">
      <label for="unidade" class="form-label">Unidade</label>
      <select name="unidade" id="unidade" class="form-select" disabled required>
        <option value="">Selecione a unidade</option>
      </select>
    </div>

    <!-- Tópico -->
    <div class="mb-3">
      <label for="topico" class="form-label">Tópico</label>
      <select name="topico" id="topico" class="form-select" disabled required>
        <option value="">Selecione o tópico</option>
      </select>
    </div>

    <!-- Subtópico -->
    <div class="mb-3">
      <label for="subtopico" class="form-label">Subtópico</label>
      <select name="subtopico" id="subtopico" class="form-select" disabled required>
        <option value="">Selecione o subtópico</option>
      </select>
    </div>

    <!-- Categoria -->
    <div class="mb-3">
      <label for="categoria" class="form-label">Categoria</label>
      <select name="categoria" id="categoria" class="form-select" disabled required>
        <option value="">Selecione a categoria</option>
      </select>
    </div>

    <!-- Ano -->
    <div class="mb-3">
      <label for="ano" class="form-label">Ano</label>
      <input type="number" name="ano" id="ano" class="form-control" required>
    </div>

    <!-- Banca -->
    <div class="mb-3">
      <label for="banca" class="form-label">Banca</label>
      <select name="banca" id="banca" class="form-select" required>
        <option value="">Selecione a banca</option>
        <option value="Todas">Todas</option>
        <option value="ENEM">ENEM</option>
        <option value="FGV">FGV</option>
        <option value="FUVEST">FUVEST</option>
      </select>
    </div>

    <!-- Tipo de questão -->
    <div class="mb-3">
      <label for="tipo_questao" class="form-label">Tipo de questão</label>
      <select name="tipo_questao" id="tipo_questao" class="form-select" required>
        <option value="">Selecione o tipo</option>
        <option value="Todos">Todos</option>
        <option value="Múltipla escolha">Múltipla escolha</option>
        <option value="Discursiva">Discursiva</option>
        <option value="Verdadeiro ou falso">Verdadeiro ou falso</option>
        <option value="Somatório">Somatório</option>
        <option value="Múltiplas respostas">Múltiplas respostas</option>
        <option value="Analítica">Analítica (dissertativa)</option>
      </select>
    </div>

    <!-- Nível de dificuldade -->
    <div class="mb-3">
      <label for="dificuldade" class="form-label">Nível de dificuldade</label>
      <select name="dificuldade" id="dificuldade" class="form-select" required>
        <option value="">Selecione o nível</option>
        <option value="Fáceis">Fácil</option>
        <option value="Médias">Médio</option>
        <option value="Difíceis">Difícil</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary w-100">Cadastrar Questão</button>
  </form>
</div>

<script>
  function carregarFilhos(pai_id, seletor_filho) {
    if (!pai_id) {
      $(seletor_filho).html('<option value="">Selecione</option>').prop('disabled', true);
      return;
    }

    $.get("{% url 'buscar_conteudos' %}", { pai_id: pai_id }, function(data) {
      let options = '<option value="">Selecione</option>';
      data.forEach(function(item) {
        options += `<option value="${item.id}">${item.nome}</option>`;
      });

      $(seletor_filho).html(options).prop('disabled', false);
    });
  }

  $('#area').on('change', function() {
    carregarFilhos(this.value, '#unidade');
    $('#topico, #subtopico, #categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#unidade').on('change', function() {
    carregarFilhos(this.value, '#topico');
    $('#subtopico, #categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#topico').on('change', function() {
    carregarFilhos(this.value, '#subtopico');
    $('#categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#subtopico').on('change', function() {
    carregarFilhos(this.value, '#categoria');
  });
</script>

</body>
</html>
