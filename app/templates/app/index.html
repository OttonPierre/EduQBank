{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastrar Questão</title>
  <link rel="stylesheet" href="{% static 'app/css/bootstrap.min.css' %}" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="{% static 'app/js/bootstrap.min.js' %}"></script>

  <style>
    body {
      background-color: #f8f9fa;
    }

    .form-container {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-top: 50px;
    }

    .form-title {
      font-weight: 600;
      font-size: 24px;
      margin-bottom: 25px;
    }

    .form-label {
      font-weight: 500;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="form-container">
        <div class="form-title">Cadastrar Nova Questão</div>

        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
            </div>
          {% endfor %}
        {% endif %}

        <form method="post" action="">
          {% csrf_token %}

          <!-- Área -->
          <div class="mb-3">
            <label for="area" class="form-label">Área</label>
            <select name="area" id="area" class="form-select" required>
              <option value="">Selecione</option>
              {% for area in areas %}
                <option value="{{ area.id }}">{{ area.nome }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Unidade -->
          <div class="mb-3">
            <label for="unidade" class="form-label">Unidade</label>
            <select name="unidade" id="unidade" class="form-select" disabled>
              <option value="">Selecione</option>
            </select>
          </div>

          <!-- Tópico -->
          <div class="mb-3">
            <label for="topico" class="form-label">Tópico</label>
            <select name="topico" id="topico" class="form-select" disabled>
              <option value="">Selecione</option>
            </select>
          </div>

          <!-- Subtópico -->
          <div class="mb-3">
            <label for="subtopico" class="form-label">Subtópico</label>
            <select name="subtopico" id="subtopico" class="form-select" disabled>
              <option value="">Selecione</option>
            </select>
          </div>

          <!-- Categoria -->
          <div class="mb-3">
            <label for="categoria" class="form-label">Categoria</label>
            <select name="categoria" id="categoria" class="form-select" disabled>
              <option value="">Selecione</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="ano" class="form-label">Ano</label>
              <input type="number" name="ano" id="ano" class="form-control" min="1900" max="2030" placeholder="Ex: 2025" required>
            </div>

            <div class="col-md-6 mb-3">
              <label for="banca" class="form-label">Banca</label>
              <select name="banca" id="banca" class="form-select" required>
                <option value="">Selecione</option>
                <option value="N_IDENTIFICADA">Não identificada</option>
                <option value="ENEM">Enem</option>
                <option value="FGV">FGV</option>
                <option value="FUVEST">Fuvest</option>
                <option value="EDUQBANK">EduQbank</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="tipo_questao" class="form-label">Tipo de Questão</label>
              <select name="tipo_questao" id="tipo_questao" class="form-select" required>
                <option value="">Selecione</option>
                <option value="multipla_escolha">Múltipla escolha</option>
                <option value="discursiva">Discursiva</option>
                <option value="verdadeiro_falso">Verdadeiro ou falso</option>
                <option value="somatorio">Somatório</option>
                <option value="multiplas_respostas">Múltiplas respostas</option>
                <option value="analitica">Analítica (dissertativa)</option>
              </select>
            </div>

            <div class="col-md-6 mb-3">
              <label for="dificuldade" class="form-label">Nível de Dificuldade</label>
              <select name="dificuldade" id="dificuldade" class="form-select" required>
                <option value="">Selecione</option>
                <option value="Fácil">Fácil</option>
                <option value="Média">Média</option>
                <option value="Difícil">Difícil</option>
              </select>
            </div>
          </div>

          <!-- Enunciado -->
          <div class="mb-4">
            <label for="enunciado" class="form-label">Enunciado</label>
            <textarea name="enunciado" id="enunciado" rows="5" class="form-control" required></textarea>
          </div>

          <button type="submit" class="btn btn-primary w-100">Cadastrar Questão</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  function carregarFilhos(pai_id, seletor_filho) {
    if (!pai_id) {
      $(seletor_filho).html('<option value="">Selecione</option>').prop('disabled', true);
      return;
    }

    $.get("{% url 'buscar_conteudos' %}", { pai_id: pai_id }, function(data) {
      let options = '<option value="">Selecione</option>';
      data.forEach(function(item) {
        options += `<option value="${item.id}">${item.nome}</option>`;
      });

      $(seletor_filho).html(options).prop('disabled', false);
    });
  }

  $('#area').on('change', function() {
    carregarFilhos(this.value, '#unidade');
    $('#topico, #subtopico, #categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#unidade').on('change', function() {
    carregarFilhos(this.value, '#topico');
    $('#subtopico, #categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#topico').on('change', function() {
    carregarFilhos(this.value, '#subtopico');
    $('#categoria').html('<option value="">Selecione</option>').prop('disabled', true);
  });

  $('#subtopico').on('change', function() {
    carregarFilhos(this.value, '#categoria');
  });
</script>

</body>
</html>
